(()=>{"use strict";var e={653:(e,t,r)=>{r.d(t,{Th:()=>i,dy:()=>s,mJ:()=>n,qh:()=>a});var n='let t = "test"',i="const energyPerShip = 100\nconst shipEnergy = 50\n\nif (base.resources.metal > base.shipCost && base.resources.energy > energyPerShip * Game.getShipsByTeam(base.team).length){\n    base.spawnShip(shipEnergy,false)\n}\n\nif (base.resources.metal > base.upgradeMaxEnergyCost){\n    base.upgradeMaxEnergy()\n}\n\nif (base.resources.metal > base.upgradeRefiningEfficiencyCost){\n    base.upgradeRefiningEfficiency()\n}\n\nif (base.resources.metal > base.upgradeInteractRadiusCost){\n    base.upgradeInteractRadius()\n}\n\nif (base.resources.metal > base.upgradeMaxHealthCost){\n    base.upgradeMaxHealth()\n}\n\nif (base.resources.metal > base.upgradeHealRateCost){\n    base.upgradeHealRate()\n}\n\nGraphics.drawText(base.resources.toString() + ' Health: ' + base.health.toFixed(2),base.transform.position.subtract(new Vector2D(100,0)),12,\"#FFFFFF\")\n",s='ship.target = {}\nship.state = "IDLE"\nship.arr = []\nship.shootCooldown = 10\nship.shootTimer = 0\nconsole.log("Ship start!")\n',a='const speed = 2.5\nship.shootTimer--\n\nfunction teammateHasTarget(target){\n    const teamShips = Game.getShipsByTeam(ship.team).filter((obj) => obj.uuid != ship.uuid)\n\n    if(teamShips.length > 0){\n        for (const j in teamShips){\n            if (target != null && target != undefined)\n                if (teamShips[j].target.uuid == target.uuid)\n                    return true\n        }\n    }\n    return false\n}\n\n// STATE MACHINE\nswitch(ship.state){\n\n    case "IDLE":\n\n        const asteroids = Game.getAsteroids()\n        let closest = [{},100000]\n\n        for (const index in asteroids){\n            const asteroid = asteroids[index]\n            const d = dist(asteroid,ship)\n            if (d < closest[1]){\n                if (!teammateHasTarget(asteroid)){\n                    closest = [asteroid,d]\n                }\n            }\n        }\n\n        ship.target = closest[0]\n        ship.state = "MOVE_TO_ASTEROID"\n\n        break;\n\n    case "MOVE_TO_ASTEROID":\n\n        if (ship.target.type === "ASTEROID"){\n            ship.seekTarget(ship.target,speed)\n        }else{\n            ship.target = base\n            ship.state = "MOVE_TO_BASE"\n        }\n\n        break;\n\n    case "MOVE_TO_BASE":\n\n        if (ship.resources.metal > 0 || ship.resources.water > 0 && dist(ship,base) > base.interactRadius){\n            ship.seekTarget(ship.target,speed)\n        }else{\n            ship.state = "IDLE"\n        }\n\n        break;\n\n    case "MOVE_TO_ENERGY":\n        if (ship.target.type === "ENERGY_CELL"){\n            ship.seekTarget(ship.target,speed)\n        }else if (ship.target.type === "BASE") {\n            if (ship.resources.energy > 90 || base.resources.energy < 1 || dist(ship,base) > base.interactRadius){\n                ship.state = "IDLE"\n            }else{\n                ship.seekTarget(ship.target,speed)\n            }\n        }\n        else{\n            ship.state = "IDLE"\n        }\n        break;\n        \n}\n\n// seekTarget ENERGY\nif (ship.resources.energy < (ship.maxEnergy / 3)){\n    const energyCells = Game.getEnergyCells()\n\n    let closest = [base,dist(base,ship)]\n\n    for (const index in energyCells){\n        const energyCell = energyCells[index]\n        const d = dist(energyCell,ship)\n        if (d < closest[1]){\n            if (!teammateHasTarget(energyCell)){\n                closest = [energyCell,d]\n            }\n        }\n    }\n\n    ship.target = closest[0]\n    ship.state = "MOVE_TO_ENERGY"\n}\n\n// COMBAT\nif(ship.resources.energy > (ship.maxEnergy / 2) && ship.shootTimer < 0){\n    const shootRadius = 300\n    const ships = Game.getShips()\n    \n    let closest = [{},100000]\n\n    for (const index in ships){\n        const otherShip = ships[index]\n        if (otherShip.team != ship.team){\n            const d = dist(ship,otherShip)\n            if (d < closest[1]){\n                closest = [otherShip,d]\n            }\n        }\n    }\n\n    if (closest[1] < shootRadius){\n        ship.shoot(closest[0].transform.position.add(closest[0].transform.velocity.multiply(720)).subtract(ship.transform.position))\n        ship.shootTimer = ship.shootCooldown\n    }\n}\n\n// UPGRADES\nif (base.resources.metal > ship.upgradeMaxEnergyCost && Game.getShipsByTeam(ship.team).length > 2){\n    ship.upgradeMaxEnergy()\n}\n\nif (base.resources.metal > ship.upgradeDamageCost && Game.getShipsByTeam(ship.team).length > 2){\n    ship.upgradeDamage()\n}\n\nship.targetID = ship.target.uuid\n\n// DEBUG DRAWING\nGraphics.drawText(ship.resources.toString(),ship.transform.position,10,"#FFFFFF")\nGraphics.drawText(ship.state,ship.transform.position.subtract(new Vector2D(0,1).multiply(-10)),8,"#FFFFFF")\nif (ship.target != undefined && ship.target.transform != undefined)\n    Graphics.drawLine(ship.transform.position,ship.target.transform.position,"#00FF00")\n'},701:(e,t,r)=>{r.d(t,{Z:()=>s});var n=r(653);function i(e){e.session.setMode("ace/mode/javascript"),e.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0,fontSize:"12pt"})}document.getElementById("select-script").addEventListener("change",(function(e){var t=e.target.value,r=c.getSession().getValue();a[o]=ace.createEditSession(r),o=t,"string"==typeof a[t]?c.session.setValue(a[t]):c.setSession(a[t]),i(c)}));var s=function(){a[o]=c.getSession().getValue();var e={};return Object.keys(a).forEach((function(t,r){var n=a[t];"string"==typeof n?(e[t]=n,localStorage.setItem(t,n||" ")):(e[t]=n.getValue(),localStorage.setItem(t,n.getValue()||" "))})),e},a={"Base Start":localStorage.getItem("Base Start")||n.mJ,"Base Update":localStorage.getItem("Base Update")||n.Th,"Ship Start":localStorage.getItem("Ship Start")||n.dy,"Ship Update":localStorage.getItem("Ship Update")||n.qh},o="Ship Update";ace.require("ace/ext/language_tools").addCompleter({getCompletions:function(e,t,r,n,i){i(null,[{name:"Vector2D()",description:"Vector2D(x : number, y : number)"},{name:"dist()",description:"dist(v1 : Vector2D, v2 : Vector2D) => number"},{name:"overlapCircle()",description:"overlapCircle(pos : Vector2D, radius : number) => GameObject[]"},{name:"console.log()",description:"console.log()"},{name:"Game",description:"Game"},{name:"Game.getAsteroids()",description:"Game.getAsteroids() => Asteroid[]"},{name:"Game.getClosestAsteroid()",description:"Game.getClosestAsteroid(pos : Vector2D) => Asteroid"},{name:"Game.getEnergyCells()",description:"Game.getEnergyCells() => EnergyCell[]"},{name:"Game.getClosestEnergyCell()",description:"Game.getClosestEnergyCell(pos : Vector2D) => EnergyCell"},{name:"Game.getShips()",description:"Game.getShips() => Ship[]"},{name:"Game.getShipsByTeam()",description:"Game.getShipsByTeam(team : number) => Ship[]"},{name:"Game.getBases()",description:"Game.getBases() => Base[]"},{name:"Game.getBaseByTeam()",description:"Game.getBaseByTeam(team : number) => Base"},{name:"Game.getObjectFromUUID()",description:"Game.getObjectFromUUID(uuid : number) => GameObject"},{name:"Game.getBullets()",description:"Game.getBullets() => Bullet[]"},{name:"Game.getObstacles()",description:"Game.getObstacles() => Obstacle[]"},{name:"Game.getClosestObstacle()",description:"Game.getClosestObstacle() => Obstacle"},{name:"Graphics.H",description:"Graphics.H : number"},{name:"Graphics.W",description:"Graphics.W : number"},{name:'Graphics.drawText("text", ,8,"#FFFFFF")',description:"Graphics.drawText(text : string, pos : Vector2D, size : number, color : string)"},{name:'Graphics.drawLine(,,"#FFFFFF")',description:"Graphics.drawLine(start : Vector2D, end : Vector2D, color : string)"},{name:'Graphics.drawCircle(,,"#FFFFFF")',description:"Graphics.drawCircle(pos : Vector2D, radius : number, color : string)"},{name:'Graphics.drawCircleTransparent(,,"#FFFFFF",1.0)',description:"Graphics.drawCircleTransparent(pos : Vector2D, radius : number, color : string, alpha : number)"},{name:"ship",description:"ship : Ship"},{name:"ship.seekTarget()",description:"ship.seekTarget(target : GameObject, speed : number)"},{name:"ship.moveTo()",description:"ship.moveTo(pos : Vector2D, speed : number)"},{name:"ship.shoot()",description:"ship.shoot(dir : Vector2D)"},{name:"ship.uuid",description:"ship.uuid : number"},{name:"ship.team",description:"ship.team : number"},{name:"ship.transform",description:"ship.transform : Transform"},{name:"ship.transform.position",description:"ship.transform.position : Vector2D"},{name:"ship.transform.velocity",description:"ship.transform.velocity : Vector2D"},{name:"ship.transform.acceleration",description:"ship.transform.acceleration : Vector2D"},{name:"ship.upgradeMaxEnergy()",description:"ship.upgradeMaxEnergy()"},{name:"ship.upgradeDamage()",description:"ship.upgradeDamage()"},{name:"ship.upgradeMaxEnergyCost",description:"ship.upgradeMaxEnergyCost : number"},{name:"ship.upgradeDamageCost",description:"ship.upgradeDamageCost : number"},{name:"ship.collider",description:"ship.collider : collider"},{name:"ship.resources",description:"ship.resources : Resources"},{name:"ship.resources.metal",description:"ship.resources.metal : number"},{name:"ship.resources.water",description:"ship.resources.water : number"},{name:"ship.resources.energy",description:"ship.resources.energy : number"},{name:"base",description:"base : Base"},{name:"base.uuid",description:"base.uuid : number"},{name:"base.team",description:"base.team : number"},{name:"base.health",description:"base.health : number"},{name:"base.shipCost",description:"base.shipCost : number"},{name:"base.healRate",description:"base.healRate : number"},{name:"base.upgradeHealRateCost",description:"base.upgradeHealRateCost : number"},{name:"base.maxEnergy",description:"base.maxEnergy : number"},{name:"base.upgradeMaxEnergyCost",description:"base.upgradeMaxEnergyCost : number"},{name:"base.refiningRate",description:"base.refiningRate : number"},{name:"base.upgradeRefiningRateCost",description:"base.upgradeRefiningRateCost : number"},{name:"base.interactRadius",description:"base.interactRadius : number"},{name:"base.upgradeInteractRadiusCost",description:"base.upgradeInteractRadiusCost : number"},{name:"base.refiningEfficiency",description:"base.refiningEfficiency : number"},{name:"base.upgradeRefiningEfficiencyCost",description:"base.upgradeRefiningEfficiencyCost : number"},{name:"base.repairRate",description:"base.repairRate : number"},{name:"base.upgradeRepairRateCost",description:"base.upgradeRepairRateCost : number"},{name:"base.maxHealth",description:"base.maxHealth : number"},{name:"base.upgradeMaxHealthCost",description:"base.upgradeMaxHealthCost : number"},{name:"base.spawnShip()",description:"base.spawnShip(energy : number)"},{name:"base.upgradeHealRate()",description:"base.upgradeHealRate()"},{name:"base.upgradeMaxEnergy()",description:"base.upgradeMaxEnergy()"},{name:"base.upgradeRefiningRate()",description:"base.upgradeRefiningRate()"},{name:"base.upgradeInteractRadius()",description:"base.upgradeInteractRadius()"},{name:"base.upgradeRefiningEfficiency()",description:"base.upgradeRefiningEfficiency()"},{name:"base.upgradeRepairRate()",description:"base.upgradeRepairRate()"},{name:"base.upgradeMaxHealth()",description:"base.upgradeMaxHealth()"}].map((function(e){return{caption:e.description,value:e.name,meta:"ai-arena API"}})))}});var c=ace.edit("editor");c.setTheme("ace/theme/tomorrow_night_eighties"),c.session.setValue(a[o]),i(c)},66:(e,t,r)=>{var n,i,s,a,o,c,u,p=r(653),l='\n    console.log("Base Start!")\n',h="\n    const energyPerShip = 100\n    const shipEnergy = 50\n\n    if (base.resources.metal > base.shipCost && base.resources.energy > energyPerShip * Game.getShipsByTeam(base.team).length){\n        base.spawnShip(shipEnergy,false)\n    }\n\n    if (base.resources.metal > base.upgradeMaxEnergyCost){\n        base.upgradeMaxEnergy()\n    }\n\n    if (base.resources.metal > base.upgradeRefiningEfficiencyCost){\n        base.upgradeRefiningEfficiency()\n    }\n\n    if (base.resources.metal > base.upgradeInteractRadiusCost){\n        base.upgradeInteractRadius()\n    }\n\n    if (base.resources.metal > base.upgradeMaxHealthCost){\n        base.upgradeMaxHealth()\n    }\n\n    if (base.resources.metal > base.upgradeHealRateCost){\n        base.upgradeHealRate()\n    }\n\n    Graphics.drawText(base.resources.toString() + ' Health: ' + base.health.toFixed(2),base.transform.position.subtract(new Vector2D(100,0)),12,\"#FFFFFF\")\n",d='\n    ship.target = {}\n    ship.state = "IDLE"\n    ship.arr = []\n    ship.shootCooldown = 10\n    ship.shootTimer = 0\n',f='\n\n    const speed = 2.5\n    ship.shootTimer--\n    \n    function teammateHasTarget(target){\n        const teamShips = Game.getShipsByTeam(ship.team).filter((obj) => obj.uuid != ship.uuid)\n\n        if(teamShips.length > 0){\n            for (const j in teamShips){\n                if (target != null && target != undefined)\n                    if (teamShips[j].target.uuid == target.uuid)\n                        return true\n            }\n        }\n        return false\n    }\n\n    // STATE MACHINE\n    switch(ship.state){\n\n        case "IDLE":\n\n            const asteroids = Game.getAsteroids()\n            let closest = [{},100000]\n\n            for (const index in asteroids){\n                const asteroid = asteroids[index]\n                const d = dist(asteroid,ship)\n                if (d < closest[1]){\n                    if (!teammateHasTarget(asteroid)){\n                        closest = [asteroid,d]\n                    }\n                }\n            }\n\n            ship.target = closest[0]\n            ship.state = "MOVE_TO_ASTEROID"\n\n            break;\n\n        case "MOVE_TO_ASTEROID":\n\n            if (ship.target.type === "ASTEROID"){\n                ship.seekTarget(ship.target,speed)\n            }else{\n                ship.target = base\n                ship.state = "MOVE_TO_BASE"\n            }\n\n            break;\n\n        case "MOVE_TO_BASE":\n\n            if (ship.resources.metal > 0 || ship.resources.water > 0 && dist(ship,base) > base.interactRadius){\n                ship.seekTarget(ship.target,speed)\n            }else{\n                ship.state = "IDLE"\n            }\n\n            break;\n\n        case "MOVE_TO_ENERGY":\n            if (ship.target.type === "ENERGY_CELL"){\n                ship.seekTarget(ship.target,speed)\n            }else if (ship.target.type === "BASE") {\n                if (ship.resources.energy > 90 || base.resources.energy < 1 || dist(ship,base) > base.interactRadius){\n                    ship.state = "IDLE"\n                }else{\n                    ship.seekTarget(ship.target,speed)\n                }\n            }\n            else{\n                ship.state = "IDLE"\n            }\n            break;\n            \n    }\n\n    // seekTarget ENERGY\n    if (ship.resources.energy < (ship.maxEnergy / 3)){\n        const energyCells = Game.getEnergyCells()\n\n        let closest = [base,dist(base,ship)]\n\n        for (const index in energyCells){\n            const energyCell = energyCells[index]\n            const d = dist(energyCell,ship)\n            if (d < closest[1]){\n                if (!teammateHasTarget(energyCell)){\n                    closest = [energyCell,d]\n                }\n            }\n        }\n\n        ship.target = closest[0]\n        ship.state = "MOVE_TO_ENERGY"\n    }\n\n    // COMBAT\n    if(ship.resources.energy > (ship.maxEnergy / 2) && ship.shootTimer < 0){\n        const shootRadius = 250\n        const ships = Game.getShips()\n        \n        let closest = [{},100000]\n\n        for (const index in ships){\n            const otherShip = ships[index]\n            if (otherShip.team != ship.team){\n                const d = dist(ship,otherShip)\n                if (d < closest[1]){\n                    closest = [otherShip,d]\n                }\n            }\n        }\n\n        if (closest[1] < shootRadius){\n            ship.shoot(closest[0].transform.position.add(closest[0].transform.velocity.multiply(720)).subtract(ship.transform.position))\n            ship.shootTimer = ship.shootCooldown\n        }\n    }\n\n    // UPGRADES\n    if (base.resources.metal > ship.upgradeMaxEnergyCost && Game.getShipsByTeam(ship.team).length > 2){\n        ship.upgradeMaxEnergy()\n    }\n\n    if (base.resources.metal > ship.upgradeDamageCost && Game.getShipsByTeam(ship.team).length > 2){\n        ship.upgradeDamage()\n    }\n\n    ship.targetID = ship.target.uuid\n\n    // DEBUG DRAWING\n    Graphics.drawText(ship.resources.toString(),ship.transform.position,10,"#FFFFFF")\n    Graphics.drawText(ship.state,ship.transform.position.subtract(new Vector2D(0,1).multiply(-10)),8,"#FFFFFF")\n    if (ship.target != undefined && ship.target.transform != undefined)\n        Graphics.drawLine(ship.transform.position,ship.target.transform.position,"#00FF00")\n',m=function(){function e(e,t,r,n){this.uuid=e,this.type=t,this.transform=r,this.collider=n}return e.prototype.destroy=function(){this.type="DEAD"},e.prototype.simulate=function(e){this.transform.simulate(e)},e.prototype.render=function(e){},e.prototype.collide=function(e){},e.prototype.serialize=function(){},e.prototype.packet=function(){return[]},e}(),y=function(e,t,r){if(r||2===arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},g=function(){function e(e,t){this.type="VECTOR2D",this.x=e,this.y=t,this.magnitude=Math.pow(Math.pow(e,2)+Math.pow(t,2),.5)}return e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.multiply=function(t){return new e(this.x*t,this.y*t)},e.prototype.divide=function(t){return new e(this.x/t,this.y/t)},e.prototype.dot=function(e){return this.x*e.x+this.y*e.y},e.prototype.normal=function(){return new e(this.x/this.magnitude,this.y/this.magnitude)},e.prototype.copy=function(){return new e(this.x,this.y)},e.prototype.rotate=function(t){var r=Math.PI*t/180;return new e(this.x*Math.cos(r)-this.y*Math.sin(r),this.x*Math.sin(r)+this.y*Math.cos(r))},e.random=function(){return new e(Math.random()-.5,Math.random()-.5).normal()},e.dist=function(e,t){return e.subtract(t).magnitude},e.prototype.serialize=function(){return JSON.stringify([this.type,parseFloat(this.x.toFixed(4)),parseFloat(this.y.toFixed(4))])},e.prototype.packet=function(){return[this.x,this.y]},e}(),b=function(){function e(e,t,r){this.type="TRANSFORM",this.mass=e,this.position=t,this.velocity=r,this.acceleration=new g(0,0)}return e.prototype.simulate=function(e){this.velocity=this.velocity.add(this.acceleration.multiply(e).divide(Z)),this.acceleration=new g(0,0),this.position=this.position.add(this.velocity.multiply(e)),this.position.x<0&&(this.position.x+=Y),this.position.y<0&&(this.position.y+=J),this.position.x=this.position.x%Y,this.position.y=this.position.y%J},e.prototype.serialize=function(){return JSON.stringify([this.type,this.mass,this.position.serialize(),this.velocity.serialize()])},e.prototype.packet=function(){return y(y([this.mass],this.position.packet(),!0),this.velocity.packet(),!0)},e}(),v=function(){function e(e){this.type="COLLIDER",this.radius=e}return e.prototype.serialize=function(){return JSON.stringify([2,this.radius.toFixed(1)])},e}(),E=function(e,t,r){return Math.min(Math.max(t,e),r)},w=function(e,t){return e+Math.random()*(t-e)},S=function(){return Math.floor(1e7*Math.random())},C=function(e,t){return g.dist(e.transform.position,t.transform.position)},x=function(e){return null!=e&&"VECTOR2D"===e.type&&e instanceof g&&R(e.x)&&R(e.y)&&R(e.magnitude)},R=function(e){return null!=e&&!isNaN(+e)},T=function(e,t){if(x(e)&&R(t)){if(Ze.length<=0)return[];for(var r=O(Ze,e.x),n=[],i=!0,s=1;i;){i=!1,(u=r-s)<0&&(u+=Ye.length);var a=Ye[u].transform,o=Ye[u].collider.radius,c=1e5;c=u<r?e.x-a.position.x:e.x+Y-a.position.x,Math.abs(c)<t+o&&(n.push(Ye[u]),i=!0),s++}for(i=!0,s=0;i;){var u;i=!1,(u=r+s)>=Ye.length&&(u-=Ye.length),a=Ye[u].transform,o=Ye[u].collider.radius,c=1e5,c=u>=r?e.x-a.position.x:e.x+Y-a.position.x,Math.abs(c)<t+o&&(n.push(Ye[u]),i=!0),s++}for(var p=[],l=0;l<n.length;){var h=n[l],d=(a=h.transform,o=h.collider.radius,a.position);if(e.x<a.position.x&&(d=new g(a.position.x-Y,a.position.y)),(c=e.subtract(d).magnitude)>t+o){var f=d.copy();e.y<a.position.y?f.y-=J:f.y+=J;var m=e.subtract(f).magnitude;m<t+o&&(c=m,d=f)}c<t+o&&p.push(h),l++}return p}return alert("Invalid input for OverlapCircle! \n Position: ".concat(e.toString()," Radius: ").concat(t.toString())),ut(),[]},O=function(e,t){for(var r=0,n=e.length-1;r<=n;){var i=Math.floor((r+n)/2);if(e[i]==t)return i;e[i]<t?r=i+1:n=i-1}return n+1},B=(n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},n(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),M=function(){return M=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},M.apply(this,arguments)},F=function(e,t,r){if(r||2===arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},k={console,Vector2D:g,overlapCircle:T,dist:C,H:Math.floor(J),W:Math.floor(Y),performance},A=function(){function e(e,t,r){this.type="RESOURCES",this.metal=e,this.water=t,this.energy=r}return e.prototype.getResources=function(){return{metal:parseFloat(this.metal.toFixed(2)),water:parseFloat(this.water.toFixed(2)),energy:parseFloat(this.energy.toFixed(2))}},e.prototype.toString=function(){return JSON.stringify(this.getResources())},e.prototype.serialize=function(){var e=this.getResources();return JSON.stringify([this.type,e.metal,e.water,e.energy])},e.prototype.packet=function(){return[this.metal,this.water,this.energy]},e}(),I=function(e){function t(t,r,n,i,s){var a=e.call(this,t,"ASTEROID",new b(i+s,r,n),new v(Math.sqrt(i+s)))||this;return a.resources=new A(i,s,0),a}return B(t,e),t.prototype.simulate=function(t){e.prototype.simulate.call(this,t)},t.prototype.render=function(e){for(var t=1,r=this.resources.metal+this.resources.water+this.resources.energy,n=[this.resources.metal/r,this.resources.water/r,this.resources.energy/r],i=0;i<2;i++)e.drawCircle(this.transform.position,t*this.collider.radius,We[i]),t-=n[i]},t.prototype.getResources=function(){return this.resources.getResources()},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.serialize=function(){var e=this.resources.getResources();return JSON.stringify([this.type,this.uuid,this.transform.position.serialize(),this.transform.velocity.serialize(),e.metal,e.water])},t.prototype.packet=function(){var e=this.resources.getResources();return F(F(F([0,this.uuid],this.transform.position.packet(),!0),this.transform.velocity.packet(),!0),[e.metal,e.water],!1)},t}(m),D=function(e){function t(t,r,n,i){return e.call(this,t,"OBSTACLE",new b(i,r,n),new v(Math.sqrt(i)))||this}return B(t,e),t.prototype.simulate=function(t){e.prototype.simulate.call(this,t)},t.prototype.render=function(e){e.drawCircle(this.transform.position,this.collider.radius,Qe)},t.prototype.breakUp=function(){if(this.transform.mass>60)for(var e=Math.floor(2+3*Math.random()),r=0;r<e;r++){var n=.1+.15*Math.random(),i=360*r/e+45*(Math.random()-.5),s=new g(0,1).multiply(this.collider.radius/1.5).rotate(i),a=new t(S(),this.transform.position.add(s),this.transform.velocity.rotate(-i).add(this.transform.velocity),this.transform.mass*n);ht(a)}},t.prototype.destroy=function(){this.breakUp(),e.prototype.destroy.call(this)},t.prototype.serialize=function(){return JSON.stringify([this.type,this.uuid,this.transform.position.serialize(),this.transform.velocity.serialize(),parseFloat(this.transform.mass.toFixed(2))])},t.prototype.packet=function(){return F(F(F([1,this.uuid],this.transform.position.packet(),!0),this.transform.velocity.packet(),!0),[this.transform.mass],!1)},t}(m),G=function(e){function t(t,r,n,i){var s=e.call(this,t,"ENERGY_CELL",new b(i,r,n),new v(Math.sqrt(i)))||this;return s.resources=new A(0,0,i),s}return B(t,e),t.prototype.simulate=function(t){e.prototype.simulate.call(this,t)},t.prototype.render=function(e){e.drawCircle(this.transform.position,this.collider.radius,We[2])},t.prototype.getResources=function(){return this.resources.getResources()},t.prototype.destroy=function(){e.prototype.destroy.call(this)},t.prototype.serialize=function(){return JSON.stringify([this.type,this.uuid,this.transform.position.serialize(),this.transform.velocity.serialize(),this.resources.getResources().energy])},t.prototype.packet=function(){return F(F(F([2,this.uuid],this.transform.position.packet(),!0),this.transform.velocity.packet(),!0),[this.resources.getResources().energy],!1)},t}(m),L=function(e){function t(t,r,n,i,s,a){var o=this,c=new b(ue,r,n);return c.acceleration=i,(o=e.call(this,t,"SHIP",c,new v(Math.sqrt(ue)))||this).team=a,o.resources=new A(0,0,s),o.maxEnergy=le,o.damage=pe,o.upgradeMaxEnergyCost=de,o.upgradeDamageCost=he,o}return B(t,e),t.prototype.simulate=function(t){var r=Math.pow(this.transform.velocity.magnitude,2);e.prototype.simulate.call(this,t);var n=Math.abs(r-Math.pow(this.transform.velocity.magnitude,2));this.resources.energy-=n*this.totalMass()*.5*ae,this.resources.energy<0&&this.destroy(),this.resources.energy>this.maxEnergy&&(this.resources.energy=this.maxEnergy)},t.prototype.render=function(e){var t=this.transform.acceleration,r=this.transform.position;e.drawCircle(r,this.collider.radius,Je[this.team]),0!=t.y&&(t.y>0?e.drawExhaust(r,180,t.y):t.y<0&&e.drawExhaust(r,0,-t.y)),0!=t.x&&(t.x>0?e.drawExhaust(r,90,t.x):t.x<0&&e.drawExhaust(r,270,-t.x))},t.prototype.getResources=function(){return this.resources.getResources()},t.prototype.collide=function(e){switch(e.type){case"ENERGY_CELL":e instanceof G&&(c.addEnergy(this.team,e.resources.energy),this.resources.energy+=e.resources.energy,this.resources.energy>this.maxEnergy&&(this.resources.energy=this.maxEnergy),e.destroy());break;case"ASTEROID":e instanceof I&&(this.resources.metal+=e.resources.metal,this.resources.water+=e.resources.water,e.destroy());break;case"BASE":case"OBSTACLE":break;default:this.resources.energy-=function(e,t){return ae*t.transform.mass*Math.pow(e.transform.velocity.subtract(t.transform.velocity).magnitude,2)/2}(this,e)}},t.prototype.totalMass=function(){return this.transform.mass+this.resources.water+this.resources.metal},t.prototype.breakUp=function(){if(this.resources.metal+this.resources.water>80)for(var e=Math.floor(2+3*Math.random()),t=0;t<e;t++){var r=.2+.15*Math.random(),n=360*t/e+45*(Math.random()-.5),i=new g(0,1).multiply(this.collider.radius).rotate(n),s=new I(S(),this.transform.position.add(i),this.transform.velocity.multiply(.25).rotate(-n).add(this.transform.velocity),this.resources.metal*r,this.resources.water*r);ht(s)}},t.prototype.destroy=function(){var t;c.addDeath(this.team),null===(t=a.getBaseByTeam(this.team))||void 0===t||t.queueShip(),this.breakUp(),e.prototype.destroy.call(this)},t.prototype.toString=function(){return JSON.stringify({id:this.uuid,resources:this.resources.toString(),maxEnergy:this.maxEnergy,damage:this.damage})},t.prototype.toData=function(){return JSON.parse(JSON.stringify(this))},t.prototype.serialize=function(){return JSON.stringify([this.type,this.uuid,this.transform.position.serialize(),this.transform.velocity.serialize(),this.transform.acceleration.serialize(),this.resources.getResources().energy,this.team])},t.prototype.packet=function(){return F(F(F(F([3,this.uuid],this.transform.position.packet(),!0),this.transform.velocity.packet(),!0),this.transform.acceleration.packet(),!0),[this.resources.getResources().energy,this.team],!1)},t.prototype.start=function(){var e=Xe[this.team].ShipStartCode;try{e(M({ship:z.createShipProxy(this),base:z.createBaseProxy(a.getBaseByTeam(this.team))},k))}catch(e){alert("Failure in ship.start() \n Error: ".concat(e," \n Your code failed to compile")),console.log("Failure in ship.start() \n Error: ".concat(e," \n Your code failed to compile")),ut()}},t.prototype.update=function(){var e=Xe[this.team].ShipUpdateCode;try{e(M({ship:z.createShipProxy(this),base:z.createBaseProxy(a.getBaseByTeam(this.team)),Game:o,Graphics:s},k))}catch(e){alert("Failure in ship.update() \n Error: ".concat(e," \n Your code failed to compile")),console.log("Failure in ship.update() \n Error: ".concat(e," \n Your code failed to compile")),ut()}},t.prototype.applyThrust=function(e,t){if(this.transform.acceleration.magnitude<=.01){var r=E(t,0,1);this.transform.acceleration=e.normal().multiply(r)}},t.prototype.shoot=function(e){if(x(e)){this.resources.energy-=this.damage;var t=new P(S(),this.transform.position.add(e.normal().multiply(P.offset+this.collider.radius)),e.normal().multiply(ce),this.damage,this.uuid);ht(t)}else alert("Invalid input in ship.shoot()! \n Direction: ".concat(e)),ut()},t.prototype.upgradeMaxEnergy=function(){var e=a.getBaseByTeam(this.team);void 0!==e&&e.resources.metal>this.upgradeMaxEnergyCost&&(e.resources.metal-=this.upgradeMaxEnergyCost,this.maxEnergy+=le,this.upgradeMaxEnergyCost*=me)},t.prototype.upgradeDamage=function(){var e=a.getBaseByTeam(this.team);void 0!==e&&e.resources.metal>this.upgradeDamageCost&&(e.resources.metal-=this.upgradeDamageCost,this.damage+=pe,this.upgradeDamageCost*=ye)},t.prototype.seekTarget=function(e,t){if(null!=e&&e instanceof m){var r=t/W,n=e.transform.position.subtract(this.transform.position).normal().multiply(r).add(e.transform.velocity).subtract(this.transform.velocity);this.applyThrust(n,1)}else alert("Invalid input in ship.seekTarget()! \n Target: ".concat(e," Speed: ").concat(t)),ut()},t.prototype.moveTo=function(e,t){if(x(e)&&R(t)){var r=t/W,n=e.subtract(this.transform.position).normal().multiply(r).subtract(this.transform.velocity);this.applyThrust(n,1)}else alert("Invalid input in ship.moveTo()! \n Position: ".concat(e," Speed: ").concat(t)),ut()},t}(m),P=function(e){function t(t,r,n,i,s){var a=e.call(this,t,"BULLET",new b(oe,r,n),new v(Math.sqrt(oe)))||this;return a.damage=i,a.parent=s,a}return B(t,e),t.prototype.simulate=function(t){e.prototype.simulate.call(this,t)},t.prototype.render=function(e){e.drawCircle(this.transform.position,this.collider.radius,Ke)},t.prototype.collide=function(e){switch(e.type){case"SHIP":e instanceof L&&(e.resources.energy-=this.damage,e.resources.energy<0&&c.recordKill(this.parent));break;case"BASE":e instanceof H&&e.damage(this.damage);break;default:e.destroy()}this.destroy()},t.prototype.destroy=function(){this.type="DEAD"},t.prototype.serialize=function(){return JSON.stringify([this.type,this.uuid,this.transform.position.serialize(),this.transform.velocity.serialize(),this.damage,this.parent])},t.prototype.packet=function(){return F(F(F([4,this.uuid],this.transform.position.packet(),!0),this.transform.velocity.packet(),!0),[this.damage,this.parent],!1)},t.offset=5,t}(m),H=function(e){function t(t,r,n,i){var s=e.call(this,t,"BASE",new b(ge,r,new g(0,0)),new v(Math.sqrt(ge)))||this;return s.team=i,s.resources=new A(0,0,n),s.shipQueue=[],s.maxEnergy=be,s.refiningRate=we,s.refiningEfficiency=Se,s.shipCost=Ce,s.healRate=xe,s.interactRadius=Re,s.health=ve,s.maxHealth=ve,s.repairRate=Ee,s.upgradeHealRateCost=Te,s.upgradeInteractRadiusCost=Be,s.upgradeMaxEnergyCost=Me,s.upgradeRefiningRateCost=ke,s.upgradeRefiningEfficiencyCost=Ae,s.upgradeRepairRateCost=Oe,s.upgradeMaxHealthCost=Fe,s}return B(t,e),t.prototype.refineWater=function(e){if(this.resources.water>0&&this.resources.energy<this.maxEnergy){var t=this.refiningRate*e;this.resources.water-=t,this.resources.energy+=t,c.addEnergy(this.team,t)}},t.prototype.repairSelf=function(e){if(this.resources.metal>0&&this.health<this.maxHealth){var t=this.repairRate*e;this.resources.metal-=t,this.health+=t}},t.prototype.simulate=function(e){this.transform.velocity=new g(0,0),this.refineWater(e),this.repairSelf(e),this.resources.water<0&&(this.resources.water=0),this.resources.energy>this.maxEnergy?this.resources.energy=this.maxEnergy:this.resources.energy<0&&(this.resources.energy=0),this.resources.metal<0&&(this.resources.metal=0);var t=a.getShipsByTeam(this.team);for(var r in t){var n=t[r];C(this,n)<this.interactRadius&&(this.healShip(e,n),this.takeResources(n))}for(var i in this.shipQueue){var s=parseInt(i),o=this.shipQueue[s].next();!0===o.done&&(this.shipQueue.splice(s,1),!1===o.value&&this.queueShip())}this.health<0&&this.destroy()},t.prototype.damage=function(e){this.resources.energy>0?this.resources.energy-=e:this.health-=e},t.prototype.collide=function(e){var t=e.transform.position.subtract(this.transform.position).normal();e.transform.velocity=e.transform.velocity.add(t.multiply(15))},t.prototype.render=function(e){e.drawCircle(this.transform.position,this.collider.radius,Je[this.team]),e.drawArc(this.transform.position,this.collider.radius,-.001,this.resources.energy/this.maxEnergy*2*Math.PI,"#FFFF00")},t.prototype.destroy=function(){this.type="DEAD"},t.prototype.healShip=function(e,t){if(this.resources.energy>0&&t.resources.energy<t.maxEnergy){var r=this.healRate*e;this.resources.energy-=r,t.resources.energy+=r}},t.prototype.takeResources=function(e){c.addMetal(this.team,e.resources.metal),this.resources.metal+=e.resources.metal*this.refiningEfficiency,this.resources.water+=e.resources.water*this.refiningEfficiency,e.resources.metal=0,e.resources.water=0},t.prototype.trySpawnShip=function(e,t){var r=Math.min(e,le);(t||this.resources.metal>this.shipCost)&&this.resources.energy;for(var n=0;n<32;n++){var i=new g(0,1).multiply(1.5*this.collider.radius).rotate(11.25*n).add(this.transform.position),s=new L(S(),i,new g(0,0),new g(0,0),e,this.team);if(T(i,1.2*s.collider.radius).length<1)return t||(this.resources.metal-=this.shipCost),this.resources.energy-=r,ht(s),!0}return!1},t.prototype.queueShip=function(){this.shipQueue.push(function(e,t){var r;return function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}(this,(function(n){switch(n.label){case 0:r=0,n.label=1;case 1:return r<t?[4]:[3,4];case 2:n.sent(),n.label=3;case 3:return r++,[3,1];case 4:return console.log("Ship respawning"),[2,e.trySpawnShip(10,!0)]}}))}(this,fe))},t.prototype.serialize=function(){return JSON.stringify([this.type,this.uuid,this.transform.position.serialize(),this.resources.getResources().energy,this.team])},t.prototype.packet=function(){return F(F([5,this.uuid],this.transform.position.packet(),!0),[this.resources.getResources().energy,this.team],!1)},t.prototype.toData=function(){return JSON.parse(JSON.stringify(this))},t.prototype.start=function(){var e=Xe[this.team].BaseStartCode;try{e(M({base:z.createBaseProxy(this)},k))}catch(e){alert("Failure in base.start() \n Error: ".concat(e," Your code failed to compile")),console.log("Failure in base.start() \n Error: ".concat(e," Your code failed to compile")),ut()}},t.prototype.update=function(){var e=Xe[this.team].BaseUpdateCode;try{e(M({base:z.createBaseProxy(this),Game:o,Graphics:s},k))}catch(e){alert("Failure in base.update() \n Error: ".concat(e," \n Your code failed to compile")),console.log("Failure in base.update() \n Error: ".concat(e," \n Your code failed to compile")),ut()}},t.prototype.upgradeMaxEnergy=function(){this.resources.metal>this.upgradeMaxEnergyCost&&(this.maxEnergy+=be,this.resources.metal-=this.upgradeMaxEnergyCost,this.upgradeMaxEnergyCost*=Ie)},t.prototype.upgradeMaxHealth=function(){this.resources.metal>this.upgradeMaxHealthCost&&(this.maxHealth+=ve,this.resources.metal-=this.upgradeMaxHealthCost,this.upgradeMaxHealthCost*=De)},t.prototype.upgradeHealRate=function(){this.resources.metal>this.upgradeHealRateCost&&(this.healRate+=xe,this.resources.metal-=this.upgradeHealRateCost,this.upgradeHealRateCost*=Ge)},t.prototype.upgradeInteractRadius=function(){this.resources.metal>this.upgradeInteractRadiusCost&&(this.interactRadius+=Re,this.resources.metal-=this.upgradeInteractRadiusCost,this.upgradeInteractRadiusCost*=Pe)},t.prototype.upgradeRefiningRate=function(){this.resources.metal>this.upgradeRefiningRateCost&&(this.refiningRate+=we,this.resources.metal-=this.upgradeRefiningRateCost,this.upgradeRefiningRateCost*=He)},t.prototype.upgradeRepairRate=function(){this.resources.metal>this.upgradeRepairRateCost&&(this.repairRate+=Ee,this.resources.metal-=this.upgradeRepairRateCost,this.upgradeRepairRateCost*=Le)},t.prototype.upgradeRefiningEfficiency=function(){this.resources.metal>this.upgradeRefiningEfficiencyCost&&(this.refiningRate+=Se,this.resources.metal-=this.upgradeRefiningEfficiencyCost,this.upgradeRefiningEfficiencyCost*=je)},t.prototype.spawnShip=function(e){R(e)&&this.trySpawnShip(e,!1)},t}(m),j=function(e,t,r){if(r||2===arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},U=function(){function e(){}return e.packetifyGameObjectList=function(e){var t=[];for(var r in e)t=t.concat(e[r].packet());return Float32Array.from(t)},e.serializeGameObjectList=function(e){var t=[];for(var r in e)t.push(e[r].serialize());return JSON.stringify(t)},e.deserializeGameObjectList=function(t){return JSON.parse(t).map((function(t){return e.deserialize(t)}))},e.deserialize=function(e){var t=JSON.parse(e);return this.listToObj(t)},e.listToObj=function(t){if(null!=t&&void 0!==t.slice){var r=t.slice(1);for(var n in r)r[n]=e.deserialize(r[n]);switch(t[0]){case"VECTOR2D":return new(g.bind.apply(g,j([void 0],r,!1)));case"TRANSFORM":return new(b.bind.apply(b,j([void 0],r,!1)));case"COLLIDER":return new(v.bind.apply(v,j([void 0],r,!1)));case"RESOURCES":return new(A.bind.apply(A,j([void 0],r,!1)));case"ASTEROID":return new(I.bind.apply(I,j([void 0],r,!1)));case"OBSTACLE":return new(D.bind.apply(D,j([void 0],r,!1)));case"ENERGY_CELL":return new(G.bind.apply(G,j([void 0],r,!1)));case"SHIP":return new(L.bind.apply(L,j([void 0],r,!1)));case"BULLET":return new(P.bind.apply(P,j([void 0],r,!1)));case"BASE":return new(H.bind.apply(H,j([void 0],r,!1)));case"DEAD":return null;default:return t}}return t},e.unpacketify=function(e){var t=[];if(null!=e&&void 0!==e.slice)for(var r=Array.from(e),n=0;r.length>0;){switch(r[0]){case 0:n=7,t.push(new I(r[1],new g(r[2],r[3]),new g(r[4],r[5]),r[6],r[7]));break;case 1:n=6,t.push(new D(r[1],new g(r[2],r[3]),new g(r[4],r[5]),r[6]));break;case 2:n=6,t.push(new G(r[1],new g(r[2],r[3]),new g(r[4],r[5]),r[6]));break;case 3:n=9,t.push(new L(r[1],new g(r[2],r[3]),new g(r[4],r[5]),new g(r[6],r[7]),r[8],r[9]));break;case 4:n=7,t.push(new P(r[1],new g(r[2],r[3]),new g(r[4],r[5]),r[6],r[7]));break;case 5:n=5,t.push(new H(r[1],new g(r[2],r[3]),r[4],r[5]));break;default:n=1}r.splice(0,n+1)}return t},e.test=function(){var t=new g(1.25312324,3.152),r=new I(S(),t,t,100,20),n=new D(S(),t,t,100),i=new G(S(),t,t,20),s=new L(S(),t,new g(0,0),new g(0,0),20,0),a=S(),o=[r,n,i,s,new P(S(),t,t,20,a),new H(S(),t,20,0)],c=e.deserializeGameObjectList(e.serializeGameObjectList(o));for(var u in c)c[u].serialize()!==o[u].serialize()&&(console.log("Serialization failed!"),console.log(o[u]),console.log(c[u]));var p=e.unpacketify(e.packetifyGameObjectList(o));for(var u in p)p[u].serialize()!==o[u].serialize()&&(console.log("Packetification failed!"),console.log(o[u]),console.log(p[u]))},e}(),z=function(){function e(){}return e.createRendererProxy=function(e){var t=["drawText","drawLine","drawCircle","drawCircleTransparent"],r={get:function(e,r){var n=Reflect.get(e,r);return t.includes(r)?"function"==typeof n?function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return n.apply(e,t)}:n:null},set:function(e,t,r,n){return!1},deleteProperty:function(e,t){return!1},defineProperty:function(e,t,r){return!1}};return new Proxy(e,r)},e.createGameObjectProxy=function(e){var t=["transform","collider","resources"],r=["spawnShip","upgradeInteractRadius","upgradeHealRate","upgradeMaxEnergy","update","start","serialize","queueShip","trySpawnShip","takeResources","healShip","destroy","render","collide","simulate","shipQueue","moveTo","seekTarget","upgradeDamage","shoot","applyThrust","breakup","totalMass","getResources","toString","colors"];return new Proxy(e,{get:function(e,n){var i=Reflect.get(e,n);return t.includes(n)?U.deserialize(i.serialize()):r.includes(n)?null:i},set:function(e,t,r,n){return!1},deleteProperty:function(e,t){return!1},defineProperty:function(e,t,r){return!1}})},e.createShipProxy=function(e){var t=["uuid","team","maxEnergy","damage","upgradeMaxEnergyCost","upgradeDamageCost","upgradeMaxEnergy","upgradeDamage","seekTarget","moveTo","shoot"],r=["transform","collider","resources"],n=["simulate","render","getResources","collide","totalMass","destroy","toString","serialize","createProxy","start","update"],i={get:function(e,t){var i=Reflect.get(e,t);return r.includes(t)?U.deserialize(i.serialize()):n.includes(t)?null:"function"==typeof i?function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return i.apply(e,t)}:i},set:function(e,i,s,a){return!(n.includes(i)||r.includes(i)||t.includes(i)||(Reflect.set(e,i,s,a),0))},deleteProperty:function(e,t){return!1},defineProperty:function(e,i,s){return!(n.includes(i)||r.includes(i)||t.includes(i)||(Reflect.defineProperty(e,i,s),0))}};return new Proxy(e,i)},e.createBaseProxy=function(e){var t=["uuid","team","health","shipCost","spawnShip","healRate","upgradeHealRateCost","upgradeHealRate","maxEnergy","upgradeMaxEnergyCost","upgradeMaxEnergy","refiningRate","upgradeRefiningRateCost","upgradeRefiningRate","interactRadius","upgradeInteractRadiusCost","upgradeInteractRadius","refiningEfficiency","upgradeRefiningEfficiencyCost","upgradeRefiningEfficiency","repairRate","upgradeRepairRateCost","upgradeRepairRate","maxHealth","upgradeMaxHealthCost","upgradeMaxHealth"],r=["transform","collider","resources"],n=["shipQueue","simulate","collide","render","destroy","healShip","takeResources","trySpawnShip","queueShip","serialize","createProxy","start","update"],i={get:function(e,t){if(r.includes(t))return U.deserialize(Reflect.get(e,t).serialize());if(!n.includes(t)){var i=e[t];return"function"==typeof i?function(){for(var r=[],n=0;n<arguments.length;n++)r[n]=arguments[n];return e[t].apply(e,r)}:i}return null},set:function(e,i,s,a){return!(n.includes(i)||r.includes(i)||t.includes(i)||(Reflect.set(e,i,s,a),0))},deleteProperty:function(e,t){return!1},defineProperty:function(e,i,s){return!(n.includes(i)||r.includes(i)||t.includes(i)||(Reflect.defineProperty(e,i,s),0))}};return new Proxy(e,i)},e.createObjectManagerProxy=function(t){var r=["H","W","getAsteroids","getClosestAsteroid","getObstacle","getClosestObstacle","getEnergyCells","getClosestEnergyCell","getShips","getShipsByTeam","getBullets","getBases","getBaseByTeam"],n={get:function(t,n){return r.includes(n)?function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s=Reflect.get(t,n).apply(t,r);return"[object Array]"===Object.prototype.toString.call(s)?s.map((function(t){return e.createGameObjectProxy(t)})):e.createGameObjectProxy(s)}:null},set:function(e,t,r,n){return!1},deleteProperty:function(e,t){return!1},defineProperty:function(e,t,r){return!1}};return new Proxy(t,n)},e}(),N=new WeakMap,_=function(e){try{e="with (sandbox) {"+e+"}";var t=new Function("sandbox",e);return function(e){if(!N.has(e)){var r=new Proxy(e,{has:V,get:q});N.set(e,r)}return t(N.get(e))}}catch(e){alert("Code failed to compile: \n Error: ".concat(e))}},V=function(e,t){return!0},q=function(e,t){if(t!==Symbol.unscopables)return e[t]},Y=1080,J=720,W=30,Q=1e3/W,K=1,Z=1e3*W,$=[20,200],X=[10,100],ee=[10,100],te=[20,120],re=[2e-4*W,.001*W],ne=7.5*W,ie=5*W,se=10*W,ae=25,oe=15,ce=.125,ue=50,pe=5,le=100,he=50,de=50,fe=15*W,me=1.5,ye=1.5,ge=300,be=250,ve=100,Ee=.01,we=.01,Se=1,Ce=200,xe=.01,Re=50,Te=250,Oe=250,Be=250,Me=250,Fe=250,ke=250,Ae=250,Ie=1.5,De=1.5,Ge=1.5,Le=1.5,Pe=1.5,He=1.5,je=1.5,Ue=!0,ze=!1,Ne=!1,_e=!1,Ve=1,qe={},Ye=[],Je=["#FF0000","#0000FF"],We=["#666666","#ADD8E6","#00FF00"],Qe="#A52A2A",Ke="#FFFF00",Ze=[],$e=[{BaseStartCode:"",BaseUpdateCode:"",ShipStartCode:"",ShipUpdateCode:""},{BaseStartCode:l,BaseUpdateCode:h,ShipStartCode:d,ShipUpdateCode:f}],Xe=[{BaseStartCode:_(""),BaseUpdateCode:_(""),ShipStartCode:_(""),ShipUpdateCode:_("")},{BaseStartCode:_(l),BaseUpdateCode:_(h),ShipStartCode:_(d),ShipUpdateCode:_(f)}],et=function(){},tt=function(){},rt=function(){},nt=function(e){Ne=e},it=function(e,t){$e[e].BaseStartCode=t,Xe[e].BaseStartCode=_(t)},st=function(e,t){$e[e].BaseUpdateCode=t,Xe[e].BaseUpdateCode=_(t)},at=function(e,t){$e[e].ShipStartCode=t,Xe[e].ShipStartCode=_(t)},ot=function(e,t){$e[e].ShipUpdateCode=t,Xe[e].ShipUpdateCode=_(t)},ct=function(e){ze=e},ut=function(){ze=!1,Ye=[],qe={}},pt=function(){qe={}},lt=function(){Ye.sort((function(e,t){var r=e.transform,n=t.transform;return r.position.x-n.position.x})),Ze=Ye.map((function(e){return e.transform.position.x}))},ht=function(e){if(Ye.push(e),!_e&&("SHIP"===e.type||"BASE"===e.type)){console.log("Initializing player-controlled code");var t=performance.now();e.start(),performance.now()-t>2*Ve&&(console.log("Player ".concat(e.team," ").concat(e.type," start code timed out")),rt(e.team))}},dt=function(){function e(){}return e.prototype.queueAction=function(){},e.prototype.newFrame=function(){},e.prototype.drawText=function(e,t,r,n){},e.prototype.drawLine=function(e,t,r){},e.prototype.drawCircleTransparent=function(e,t,r,n){},e.prototype.drawCircle=function(e,t,r){},e.prototype.drawArc=function(e,t,r,n,i){},e.prototype.drawExhaust=function(e,t,r){},e}(),ft=function(){function e(){this.asteroids=[],this.obstacles=[],this.energyCells=[],this.ships=[],this.bullets=[],this.bases=[],this.all=[],this.spawnQueue={ASTEROID:[],OBSTACLE:[],ENERGY_CELL:[]}}return e.prototype.start=function(){for(var t=0;t<e.numAsteroids;t++)this.spawnObject("ASTEROID");for(t=0;t<e.numObstacles;t++)this.spawnObject("OBSTACLE");for(t=0;t<e.numEnergyCells;t++)this.spawnObject("ENERGY_CELL");this.indexObjects(Ye)},e.prototype.indexObjects=function(e){this.asteroids=[],this.obstacles=[],this.energyCells=[],this.ships=[],this.bullets=[],this.bases=[],this.all=[];for(var t=0;t<e.length;t++){var r=e[t];if(null!=r&&null!=r)switch(this.all.push(r),null==r?void 0:r.type){case"ASTEROID":r instanceof I&&this.asteroids.push(r);break;case"OBSTACLE":r instanceof D&&this.obstacles.push(r);break;case"ENERGY_CELL":r instanceof G&&this.energyCells.push(r);break;case"SHIP":r instanceof L&&this.ships.push(r);break;case"BULLET":r instanceof P&&this.bullets.push(r);break;case"BASE":r instanceof H&&this.bases.push(r)}}},e.prototype.update=function(){for(var t=0,r=Object.entries(this.spawnQueue);t<r.length;t++)for(var n=r[t],i=(n[0],n[1]),s=i.length-1;s>=0;s--)!0===i[s].next().done&&i.splice(s,1);this.indexObjects(Ye),this.spawnQueue.ASTEROID.length+this.asteroids.length<e.numAsteroids&&this.queueObject("ASTEROID",ne),this.spawnQueue.OBSTACLE.length+this.obstacles.length<e.numObstacles&&this.queueObject("OBSTACLE",ie),this.spawnQueue.ENERGY_CELL.length+this.energyCells.length<e.numEnergyCells&&this.queueObject("ENERGY_CELL",se)},e.prototype.spawnObject=function(t){lt();var r=g.random().multiply(w.apply(void 0,e.speedRange)),n={};switch(t){case"ASTEROID":var i=w.apply(void 0,e.asteroidMetalRange),s=w.apply(void 0,e.asteroidWaterRange);n=new I(S(),new g(0,0),r,i,s);break;case"OBSTACLE":var a=w.apply(void 0,e.obstacleMassRange);n=new D(S(),new g(0,0),r,a);break;case"ENERGY_CELL":var o=w.apply(void 0,e.energyCellRange);n=new G(S(),new g(0,0),r,o)}if(n instanceof m)for(var c=0;c<32;c++){var u=new g(Math.random()*Y,Math.random()*J);if(T(u,1.5*n.collider.radius).length<1)return n.transform.position=u,ht(n),!0}return this.queueObject(t,180),!1},e.prototype.queueObject=function(e,t){this.spawnQueue[e].push(function(e,t,r){var n;return function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}(this,(function(i){switch(i.label){case 0:n=0,i.label=1;case 1:return n<r?[4]:[3,4];case 2:i.sent(),i.label=3;case 3:return n++,[3,1];case 4:return e.spawnObject(t),[2]}}))}(this,e,t))},e.prototype.getAsteroids=function(){return this.asteroids},e.prototype.getClosestAsteroid=function(e){var t=this.getAsteroids(),r=[{},1e5];for(var n in t){var i=t[n],s=i.transform.position.subtract(e).magnitude;s<r[1]&&(r=[i,s])}return r[0]},e.prototype.getObstacles=function(){return this.obstacles},e.prototype.getClosestObstacle=function(e){var t=this.getObstacles(),r=[{},1e5];for(var n in t){var i=t[n],s=i.transform.position.subtract(e).magnitude;s<r[1]&&(r=[i,s])}return r[0]},e.prototype.getEnergyCells=function(){return this.energyCells},e.prototype.getClosestEnergyCell=function(e){var t=this.getEnergyCells(),r=[{},1e5];for(var n in t){var i=t[n],s=i.transform.position.subtract(e).magnitude;s<r[1]&&(r=[i,s])}return r[0]},e.prototype.getShips=function(){return this.ships},e.prototype.getShipsByTeam=function(e){return this.ships.filter((function(t){return t.team===e}))},e.prototype.getBullets=function(){return this.bullets},e.prototype.getBases=function(){return this.bases},e.prototype.getBaseByTeam=function(e){try{return this.bases.filter((function(t){return t.team===e}))[0]}catch(t){console.log("Team "+e+" base has been destroyed!")}},e.prototype.getObjectFromUUID=function(e){try{return this.all.filter((function(t){return t.uuid===e}))[0]}catch(e){return null}},e.prototype.refreshObject=function(e){return this.getObjectFromUUID(e.uuid)},e.numAsteroids=15,e.numObstacles=25,e.numEnergyCells=8,e.obstacleMassRange=$,e.asteroidMetalRange=X,e.asteroidWaterRange=ee,e.energyCellRange=te,e.speedRange=re,e}(),mt=function(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}},yt=function(){function e(e,t,r){var n;this.H=e,this.W=t,this.ctx=null!==(n=r.getContext("2d"))&&void 0!==n?n:new CanvasRenderingContext2D}return e.prototype.queueAction=function(e,t,r){t in qe?qe[t].push(e.apply(void 0,r)):qe[t]=[e.apply(void 0,r)]},e.prototype.newFrame=function(){this.queueAction((function(e){return mt(this,(function(t){return e.ctx.fillStyle="#000000",e.ctx.fillRect(0,0,Y,J),[2]}))}),0,[this])},e.prototype.drawText=function(e,t,r,n){this.queueAction((function(e,t,r,n,i){var s;return mt(this,(function(a){return(s=e.ctx).fillStyle=i,s.font=n+"px sans-serif",s.fillText(t,r.x,r.y),[2]}))}),5,[this,e,t,r,n])},e.prototype.drawLine=function(e,t,r){this.queueAction((function(e,t,r,n){var i;return mt(this,(function(s){return(i=e.ctx).strokeStyle=n,i.lineWidth=1,i.beginPath(),i.moveTo(t.x,t.y),i.lineTo(r.x,r.y),i.stroke(),[2]}))}),5,[this,e,t,r])},e.prototype.drawCircleTransparent=function(e,t,r,n){this.ctx.globalAlpha=n,this.drawCircle(e,t,r),this.ctx.globalAlpha=1},e.prototype.drawCircle=function(e,t,r){this.queueAction((function(e,t,r,n){var i,s,a,o;return mt(this,(function(c){return(i=e.ctx).fillStyle=n,i.beginPath(),i.arc(t.x,t.y,r,0,2*Math.PI),i.fill(),s=t.x,a=t.y,o=!1,t.x+r>Y?(s=t.x-Y,o=!0):t.x-r<0&&(s=t.x+Y,o=!0),t.y+r>J?(a=t.y-J,o=!0):t.y-r<0&&(a=t.y+J,o=!0),o&&(i.beginPath(),i.arc(s,a,r,0,2*Math.PI),i.fill()),[2]}))}),3,[this,e,t,r])},e.prototype.drawArc=function(e,t,r,n,i){this.queueAction((function(e,t,r,n,i,s){var a,o,c,u;return mt(this,(function(p){return(a=e.ctx).fillStyle=s,a.beginPath(),a.arc(t.x,t.y,r,n,i),a.lineWidth=4,a.stroke(),o=t.x,c=t.y,u=!1,t.x+r>Y?(o=t.x-Y,u=!0):t.x-r<0&&(o=t.x+Y,u=!0),t.y+r>J?(c=t.y-J,u=!0):t.y-r<0&&(c=t.y+J,u=!0),u&&(a.beginPath(),a.arc(o,c,r,0,2*Math.PI),a.fill()),[2]}))}),2,[this,e,t,r,n,i])},e.prototype.drawExhaust=function(e,t,r){this.queueAction((function(e,t,r,n){var i;return mt(this,(function(s){return(i=e.ctx).fillStyle="#FFFFFF",i.save(),i.translate(t.x,t.y),i.rotate(r*Math.PI/180),i.beginPath(),i.moveTo(-5*n,10),i.lineTo(0,10+15*n),i.lineTo(5*n,10),i.fill(),i.restore(),[2]}))}),2,[this,e,t,r])},e}(),gt=function(){function e(){this.deaths=[0,0],this.kills=[0,0],this.metal=[0,0],this.energy=[0,0]}return e.prototype.addDeath=function(e){this.deaths[e]+=1},e.prototype.addKill=function(e){this.kills[e]+=1},e.prototype.addMetal=function(e,t){this.metal[e]+=t},e.prototype.addEnergy=function(e,t){this.energy[e]+=t},e.prototype.update=function(){for(var e in this.deaths)void 0!==a.getBaseByTeam(parseInt(e))&&"DEAD"!==a.getBaseByTeam(parseInt(e)).type||(console.log(e+" has lost"),rt(e))},e.prototype.getTeamInfo=function(e){return{kills:this.kills[e],deaths:this.deaths[e],metal:this.metal[e].toFixed(0),energy:this.energy[e].toFixed(0)}},e.prototype.serialize=function(){var e={"team 0":this.getTeamInfo(0),"team 1":this.getTeamInfo(1)};return JSON.stringify(e)},e.prototype.packet=function(){var e=[this.kills[0],this.deaths[0],this.metal[0],this.energy[0],this.kills[1],this.deaths[1],this.metal[1],this.energy[1]];return Float32Array.from(e)},e.prototype.loadFromPacket=function(e){this.kills=[e[0],e[4]],this.deaths=[e[1],e[5]],this.metal=[e[2],e[6]],this.energy=[e[3],e[7]]},e.prototype.recordKill=function(e){var t=Ye.find((function(t){return t.uuid==e}));t instanceof L&&this.addKill(t.team)},e}(),bt=null,vt=[],Et=null,wt=10*Ve,St=0,Ct=new Array(100).fill(Ve/2),xt=new Array(100).fill(Ve/2),Rt=function(){var e;console.log("Initializing game state..."),ct(!0),e=new gt,c=e,function(e){a=e,o=z.createObjectManagerProxy(a)}(new ft),ht(new H(S(),new g(Y/4,J/2),500,0)),ht(new H(S(),new g(3*Y/4,J/2),500,1)),a.indexObjects(Ye),ht(new L(S(),new g(Y/4,J/4),new g(0,0),new g(0,0),100,0)),ht(new L(S(),new g(3*Y/4,3*J/4),new g(0,0),new g(0,0),100,1)),a.start(),function(e){i=e,s=z.createRendererProxy(i)}(Ue?new yt(J,Y,u):new dt),St=0,Ct=new Array(100).fill(Ve/2),xt=new Array(100).fill(Ve/2),console.log("Game state initialized!")},Tt=function e(){if(Ue)try{var t=performance.now();!Ne&&ze&&(Mt(),pt(),et());var r=performance.now()-t;Et=setTimeout((function(){return bt=window.requestAnimationFrame(e)}),E(Q-r,0,1e3))}catch(e){alert("Failed to render \n Error: ".concat(e))}},Ot=function e(){var t=performance.now();!Ne&&ze&&(pt(),Bt(),tt());var r=performance.now()-t;vt.shift(),vt.push(setTimeout(e,E(Q-r,0,1e3))),St++},Bt=function(){lt();for(var e=Ye.length-1;e>=0;e--)"DEAD"===(t=Ye[e]).type?Ye.splice(e,1):t.simulate(Q);if(Dt(),lt(),function(e){for(var t=0,r=[];t<e.length;){for(var n=e[t].transform,i=e[t].collider.radius,s=1,a=!0;a;){a=!1;var o=t-s;o<0&&(o+=e.length);var c=e[o].transform,u=e[o].collider.radius,p=1e5;p=o<t?n.position.x-c.position.x:n.position.x+Y-c.position.x,Math.abs(p)<i+u&&(r.push([e[t],e[o]]),a=!0),s++}t++}for(t=0;t<r.length;){var l=r[t][0],h=r[t][1];if("DEAD"!==l.type&&"DEAD"!==h.type){n=l.transform,i=l.collider.radius,c=h.transform,u=h.collider.radius;var d=n.position,f=c.position;if(n.position.x<c.position.x&&(f=new g(c.position.x-Y,c.position.y)),(p=d.subtract(f).magnitude)>i+u){var m=f.copy();n.position.y<c.position.y?m.y-=J:m.y+=J;var y=d.subtract(m).magnitude;y<i+u&&(p=y,f=m)}if(p<i+u){var b=(v=d,E=f,w=n.velocity,S=c.velocity,C=n.mass,x=c.mass,R=void 0,T=void 0,O=void 0,B=void 0,M=void 0,R=v.subtract(E).normal(),T=w.subtract(S),O=-R.dot(T.multiply(1.15))/(1/C+1/x),B=R.multiply(O/C+.001),M=R.multiply(O/x+.001),[w.add(B),S.subtract(M)]);l.collide(h),h.collide(l),n.velocity=b[0],c.velocity=b[1]}}t++}var v,E,w,S,C,x,R,T,O,B,M}(Ye),a.update(),!_e)for(e=Ye.length-1;e>=0;e--){var t;if("SHIP"===(t=Ye[e]).type&&t instanceof L||"BASE"===t.type&&t instanceof H)try{var r=performance.now();t.update();var n=performance.now()-r,i=0;0==t.team?(Ct.shift(),Ct.push(n),i=Ct.reduce((function(e,t){return e+t}),0)/Ct.length):(xt.shift(),xt.push(n),i=xt.reduce((function(e,t){return e+t}),0)/xt.length);var s=St<=1?wt:Ve;if(n>s&&i>s){console.log("Player ".concat(t.team," ").concat(t.type," Update code ran in an average of ").concat(i,"ms, more than ").concat(s,"ms timeout")),alert("Player ".concat(t.team," ").concat(t.type," Update code ran in an average of ").concat(i,"ms, more than ").concat(s,"ms timeout")),a.getBaseByTeam(t.team).type="DEAD",rt(t.team);break}if(o=t,(new TextEncoder).encode(JSON.stringify(o)).length/1024>8&&(console.log("You used up too much memory!"),1)){console.log("Player ".concat(t.team," ").concat(t.type," Update code used more than ").concat(8," kb")),alert("Player ".concat(t.team," ").concat(t.type," Update code used more than ").concat(8," kb")),a.getBaseByTeam(t.team).type="DEAD",rt(t.team);break}}catch(e){console.log("User code failed with ".concat(e,". Game exiting..."));break}}var o},Mt=function(){for(var e=0;e<Ye.length;e++)null!=Ye[e]&&Ye[e].render(i);i.newFrame();for(var t=0,r=Object.entries(qe);t<r.length;t++)for(var n=r[t],s=(n[0],0),a=n[1];s<a.length;s++)a[s].next()},Ft=function(){console.log("Initializing game loops..."),kt();for(var e=0;e<K;e++)vt.push(setTimeout(Ot,Q/K*e));Tt()},kt=function(){It(),At()},At=function(){null!=bt&&cancelAnimationFrame(bt),null!=Et&&clearTimeout(Et)},It=function(){for(var e=0,t=vt;e<t.length;e++){var r=t[e];clearTimeout(r)}},Dt=function(){c.update()},Gt=function(){Ne?(nt(!1),console.log("Unpaused!")):(nt(!0),console.log("Paused!"))},Lt=function(e){var t,r;null!=e&&(null!=e.canvas&&(r=e.canvas,(u=r).width=Y,u.height=J),null!=e.graphics&&(t=e.graphics,Ue=t),null!=e.framerate&&function(e){W=e}(e.framerate),null!=e.ticksPerFrame&&function(e){K=e}(e.ticksPerFrame),null!=e.streaming&&function(e){_e=e}(e.streaming),null!=e.nodejs&&e.nodejs,null!=e.userCodeTimeout&&function(e){Ve=e}(e.userCodeTimeout))},Pt=function(e){var t;null!=e&&(void 0!==e.team0&&(void 0!==(t=e.team0).BaseStartCode&&it(0,t.BaseStartCode),void 0!==t.BaseUpdateCode&&st(0,t.BaseUpdateCode),void 0!==t.ShipStartCode&&at(0,t.ShipStartCode),void 0!==t.ShipUpdateCode&&ot(0,t.ShipUpdateCode)),void 0!==e.team1&&(void 0!==(t=e.team1).BaseStartCode&&it(1,t.BaseStartCode),void 0!==t.BaseUpdateCode&&st(1,t.BaseUpdateCode),void 0!==t.ShipStartCode&&at(1,t.ShipStartCode),void 0!==t.ShipUpdateCode&&ot(1,t.ShipUpdateCode)))},Ht=r(701);function jt(e){return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jt(e)}function Ut(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return zt(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?zt(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw s}}}}function zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}console.log((U.test(),"ai-arena package has loaded successfully!"));var Nt=document.getElementById("memory-select"),_t=document.getElementById("game-canvas"),Vt=_t.getContext("2d");Vt.fillRect(0,0,2e3,2e3);var qt={},Yt=!1,Jt=1,Wt=!1,Qt=performance.now(),Kt=void 0;document.getElementById("pause").addEventListener("click",(function(e){Gt(),Yt=!Yt,document.getElementById("pause").innerHTML=Yt?"Play":"Pause"})),document.getElementById("step").addEventListener("click",(function(e){nt(!1),setTimeout((function(){return nt(!0)}),Q),Yt=!0,document.getElementById("pause").innerHTML="Play"})),document.getElementById("compile").addEventListener("click",(function(e){var t=(0,Ht.Z)();Pt({team0:{BaseStartCode:t["Base Start"],BaseUpdateCode:t["Base Update"],ShipStartCode:t["Ship Start"],ShipUpdateCode:t["Ship Update"]}})})),document.getElementById("run").addEventListener("click",(function(e){if(Qt=performance.now(),Wt)ct(!1),kt(),ut();else try{console.log("GAME STARTED: ".concat(ze)),!1===ze&&(console.log("Game starting!"),Rt(),Ft())}catch(e){alert(" Your code broke my site dude!!! \n"+e)}Wt=!Wt,document.getElementById("run").innerHTML=Wt?"Stop":"Run"})),document.getElementById("warp").addEventListener("click",(function(e){Yt&&(Gt(),Yt=!1),Lt({ticksPerFrame:Jt=1===Jt?8:1}),document.getElementById("pause").innerHTML="Pause",document.getElementById("warp").innerHTML=1===Jt?"Warp":"Normal"}));var Zt,$t=function(e,t){var r,n=t.children,i={},s=Ut(n);try{for(s.s();!(r=s.n()).done;){var a=r.value;i[a.uuid]=a}}catch(e){s.e(e)}finally{s.f()}ir(t);var o,c=Ut(e);try{var u=function(){var e=o.value;if(e.uuid in i){var r=i[e.uuid];r.uuid=e.uuid,r.damage=e.damage,r.energy=e.resources.energy.toFixed(1)+"/"+e.maxEnergy,r.metal=e.resources.metal.toFixed(1),r.water=e.resources.water.toFixed(1)}else{var n=document.createElement("ship-object");n.uuid=e.uuid,n.damage=e.damage,n.energy=e.resources.energy.toFixed(1)+"/"+e.maxEnergy,n.metal=e.resources.metal.toFixed(1),n.water=e.resources.water.toFixed(1),n.addEventListener("click",(function(){rr(e.uuid)})),t.append(n)}};for(c.s();!(o=c.n()).done;)u()}catch(e){c.e(e)}finally{c.f()}},Xt=function(e){var t=document.getElementById("memory-inspector");er(t),e&&e.transform&&(sr(e.transform.position),tr(t,e,0))},er=function(e){for(var t=e.lastElementChild;t;)e.removeChild(t),t=e.lastElementChild},tr=function e(t,r,n){for(var i in r)if("function"!=typeof r[i])if("object"==jt(r[i])){var s=document.createElement("mem-field");s.field=" ".repeat(n)+i.toUpperCase(),s.value="",t.appendChild(s),e(t,r[i],n+1)}else{var a=document.createElement("mem-field");a.field=" ".repeat(n)+i.toUpperCase(),a.value=r[i],t.appendChild(a)}},rr=function(e){e in qt&&(Kt=e,Xt(qt[e]))},nr=function(e,t){var r=document.createElement("mem-index");r.type=t.type,r.uuid=t.uuid,r.addEventListener("click",(function(){rr(t.uuid)})),e.appendChild(r)},ir=function(e){var t,r=Ut(e.children);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.uuid in qt||e.removeChild(n)}}catch(e){r.e(e)}finally{r.f()}},sr=function(e){Vt.fillStyle="#FFFF00",Vt.globalAlpha=.3,Vt.beginPath(),Vt.arc(e.x,e.y,25,0,2*Math.PI),Vt.fill(),Vt.globalAlpha=1};null!=(Zt={ui:function(){performance.now();var e=JSON.parse(c.serialize()),t=e["team 0"],r=e["team 1"];document.getElementById("team0-kills").innerHTML=t.kills,document.getElementById("team0-deaths").innerHTML=t.deaths,document.getElementById("team0-metal").innerHTML=Math.round(t.metal),document.getElementById("team0-energy").innerHTML=Math.round(t.energy),document.getElementById("team1-kills").innerHTML=r.kills,document.getElementById("team1-deaths").innerHTML=r.deaths,document.getElementById("team1-metal").innerHTML=Math.round(r.metal),document.getElementById("team1-energy").innerHTML=Math.round(r.energy),document.getElementById("timer").innerHTML="Timesteps: "+(60*(performance.now()-Qt)/1e3).toFixed(0);var n=U.deserializeGameObjectList(U.serializeGameObjectList(Ye));(function(e,t){ir(e);var r,n=Ut(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;null==i||i.uuid in qt||nr(e,i)}}catch(e){n.e(e)}finally{n.f()}qt={};var s,a=Ut(t);try{for(a.s();!(s=a.n()).done;){var o=s.value;null!=o&&(qt[o.uuid]=o)}}catch(e){a.e(e)}finally{a.f()}})(Nt,n),qt[Kt]&&Xt(qt[Kt]);var i={team0:a.getShipsByTeam(0).filter((function(e){return e.toData()})),team1:a.getShipsByTeam(1).filter((function(e){return e.toData()}))};i.team0&&i.team1&&$t(i.team0,document.getElementById("ship-panel-0")),$t(i.team1,document.getElementById("ship-panel-1"))}})&&(void 0!==Zt.gameEnd&&(rt=Zt.gameEnd),void 0!==Zt.ui&&function(e){et=e}(Zt.ui),void 0!==Zt.physics&&function(e){tt=e}(Zt.physics)),Lt({canvas:_t,graphics:!0,ticksPerFrame:Jt,framerate:60}),Pt({team0:{BaseStartCode:localStorage.getItem("Base Start")||p.mJ,BaseUpdateCode:localStorage.getItem("Base Update")||p.Th,ShipStartCode:localStorage.getItem("Ship Start")||p.dy,ShipUpdateCode:localStorage.getItem("Ship Update")||p.qh}})}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,r),s.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r(701),r(66)})();